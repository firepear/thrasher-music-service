<!DOCTYPE html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Semi+Condensed:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/AlertifyJS/1.13.1/css/alertify.min.css" integrity="sha512-IXuoq1aFd2wXs4NqGskwX2Vb+I8UJ+tGJEu/Dc0zwLNKeQ7CW3Sr6v0yU3z5OQWe3eScVIkER4J9L7byrgR/fA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/AlertifyJS/1.13.1/css/themes/default.min.css" integrity="sha512-RgUjDpwjEDzAb7nkShizCCJ+QTSLIiJO1ldtuxzs0UIBRH4QpOjUU9w47AF9ZlviqV/dOFGWF6o7l3lttEFb6g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/client/client.css" />
  </head>
  <body>
    <div id="container">
      <div id="facets">
        <div class="title">Facets</div>
        <div id="facetlist"></div>
      </div>
      <div id="artists">
        <div class="title">Artists</div>
        <div class="listfilter">Filter <input id="artistfilter" onKeyUp="filterArtists();" /></div>
        <div id="artistlist"></div>
      </div>
      <div id="main">
        <div id="player">
          <table><tbody>
              <tr>
                <td><h2>Shawnify</h2></td>
                <td id="current" rowspan="2">
                  <div id="curtitle">This is where</div>
                  <div id="curaay">current track info</div>
                  <div id="curfacets">will go</div>
                  <div id="curnum"></div>
                </td>
              </tr>
              <tr><td style="vertical-align: top;">
                  <span id="buttonbox">
                    <button id="prevbtn" onClick="playPrev();">‚èÆ</button>
                    <button id="playbtn" onClick="startPlaying();">‚èµ</button>
                    <button id="stopbtn" onClick="stopPlaying();">‚è∏</button>
                    <button id="nextbtn" onClick="playNext();">‚è≠</button>
                    <!-- <button id="shuflbtn" onClick="toglShufl();">üîÄ</button> -->
                  </span>
              </td></tr>
          </tbody></table>
        </div>
        <div id="tracklist">
          <table id="maintable"><tbody></tbody></table>
        </div>
      </div>
      <div id="foot">
        Search <input id="filter" type="text" size="40" onKeyUp="setFilter(event);"></input>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.core.min.js" integrity="sha512-d00Brs/+XQUUaO0Y9Uo8Vw63o7kS6ZcLM2P++17kALrI8oihAfL4pl1jQObeRBgv06j7xG0GHOhudAW0BdrycA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/AlertifyJS/1.13.1/alertify.min.js" integrity="sha512-JnjG+Wt53GspUQXQhc+c4j8SBERsgJAoHeehagKHlxQN+MtCCmFDghX9/AcbkkNRZptyZU4zC8utK59M5L45Iw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
      var host = "10.1.10.210:8080";
      var els = {};
      var facetdivs = [];
      var artistdivs = [];
      var trks = [];
      var trkInfo = [];
      var trkIdx = 0;
      var filterMeta = [];
      var playing = false;
      var sound;

      var elnames = ["facetlist", "artistlist", "artistfilter", "filter", "main", "maintable", "tracklist", "curtitle", "curaay", "curfacets", "curnum"];
      elnames.forEach((name) => ( els[name] = document.getElementById(name) ));

      (async() => {
          const regex = /["'& ]/g;
          const catAF = await fetch(`http://${host}/init`).then((r) => { return r.json() });
          catAF.facets.forEach((facet) => {
              const nfacet = facet.replaceAll(regex, "");
              els["facetlist"].insertAdjacentHTML("beforeend", `<div id="fd${nfacet}"><input type="checkbox" id="fc${nfacet}" value="${facet}" onClick="buildCheckQuery('facet');" /><label for="fc${nfacet}">${facet}</label></div>`);
              facetdivs.push(document.getElementById(`fd${nfacet}`));
          });
          catAF.artists.forEach((artist) => {
              let nartist = artist.replaceAll(regex, "");
              artist = artist.replaceAll(/"/g, "&quot;");
              els["artistlist"].insertAdjacentHTML("beforeend", `<div id="ad${nartist}"><input type="checkbox" id="ac${nartist}" value="${artist}" onClick="buildCheckQuery('artist');" /><label for="ac${nartist}">${artist}</label></div>`);
              artistdivs.push(document.getElementById(`ad${nartist}`));
          });
          // set facetlit height
          els["facetlist"].style.height = (els["facetlist"].parentNode.clientHeight - els["facetlist"].previousElementSibling.clientHeight) + "px";
          // set artistlist height
          els["artistlist"].style.height = (els["artistlist"].parentNode.clientHeight - els["artistlist"].previousElementSibling.clientHeight - els["artistlist"].previousElementSibling.previousElementSibling.clientHeight) + "px";
          // set tracklist height
          els["tracklist"].style.height = (els["tracklist"].parentNode.clientHeight - els["tracklist"].previousElementSibling.clientHeight) + "px";
          // start the isPlaying ticker
          setInterval(isPlaying, 333);
      })();
    </script>
  </body>
</html>
